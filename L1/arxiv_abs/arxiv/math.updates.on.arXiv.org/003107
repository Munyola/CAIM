In this work, we consider a network of energy harvesting devices served by an access point with a single
antenna that is used for both wireless power transfer (WPT) and information reception. The objective
is to maximize the sum throughput of the network over a finite horizon when the channel state information
is only available causally. The devices are energized by WPT for a certain duration, which is subject
to optimization, and then, their tasks are offloaded to the AP until the end of the time horizon by
employing optimal dynamic power allocation. First, a single client case is investigated by modeling
the joint optimization problem as a dynamic programming problem. Based on the characteristic of
the problem, we prove that a time dependent threshold type structure exist for the optimal WPT duration,
and we obtain closed form solution to the dynamic power allocation in the offloading period. Then,
we consider the case of multiple energy harvesting devices and propose both a centralized and a distributed
policy to determine the optimal stopping time of WPT. Unlike the centralized policy, the distributed
policy does not require the complete network state information, and the decision to stop WPT is given
by the AP based on the limited feedback from the devices sent only when they observe that a threshold
is exceeded. The optimal number of feedback needed to make the transition is determined by a policysearch
reinforcement learning method. We demonstrate numerically that the distributed policy is able
to achieve very good performance with respect to the centralized policy. 